/**
 * DatePicker Component - Seguros Bolivar UI Design System
 * Input field + Calendar dropdown
 * - CSS Nesting nativo con &
 * - @layer para control de cascada
 * - Logical Properties (RTL/LTR)
 * - clamp() para responsive fluido
 *
 * Uso: 
 * <div class="sb-ui-datepicker">
 *   <div class="sb-ui-datepicker__wrapper">
 *     <input type="text" class="sb-ui-input" placeholder="DD/MM/YYYY" readonly />
 *     <button class="sb-ui-datepicker__trigger">ðŸ“…</button>
 *   </div>
 *   <div class="sb-ui-datepicker__dropdown">
 *     <!-- Calendar component here -->
 *   </div>
 * </div>
 */

@layer reset, tokens, base, variants, sizes, modifiers, states, utilities;

/* ========================================
   RESET LAYER
   ======================================== */
@layer reset {
  /* El datepicker es solo un contenedor, NO resetea sus hijos */
  /* Los componentes hijos (sb-ui-input, sb-ui-calendar) mantienen sus propios estilos */
}

/* ========================================
   TOKENS LAYER - Variables CSS
   ======================================== */
@layer tokens {
  .sb-ui-datepicker {
    /* Container */
    --sb-ui-datepicker-inline-size: clamp(200px, 100%, 300px);
    
    /* Trigger button (calendar icon) */
    --sb-ui-datepicker-trigger-size: clamp(36px, 2.2rem + 0.5vw, 44px);
    --sb-ui-datepicker-trigger-bg: transparent;
    --sb-ui-datepicker-trigger-bg-hover: var(--sb-ui-color-grayscale-L400, #f5f5f5);
    --sb-ui-datepicker-trigger-bg-active: var(--sb-ui-color-grayscale-L300, #e8e8e8);
    --sb-ui-datepicker-trigger-color: var(--sb-ui-color-grayscale-base, #666);
    --sb-ui-datepicker-trigger-color-hover: var(--sb-ui-color-primary-base, #038450);
    
    /* Dropdown */
    --sb-ui-datepicker-dropdown-bg: var(--sb-ui-color-grayscale-white, #fff);
    --sb-ui-datepicker-dropdown-border-color: var(--sb-ui-color-grayscale-L200, #e0e0e0);
    --sb-ui-datepicker-dropdown-border-width: 1px;
    --sb-ui-datepicker-dropdown-border-radius: clamp(8px, 0.5rem + 0.5vw, 12px);
    --sb-ui-datepicker-dropdown-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    --sb-ui-datepicker-dropdown-margin-block-start: clamp(0.25rem, 0.2rem + 0.3vw, 0.5rem);
    
    /* Transitions */
    --sb-ui-datepicker-transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease;
  }
}

/* ========================================
   BASE LAYER - Estilos base
   ======================================== */
@layer base {
  .sb-ui-datepicker {
    display: inline-block;
    position: relative;
    inline-size: var(--sb-ui-datepicker-inline-size);
    font-family: var(--sb-ui-datepicker-input-font-family);
  }
  
  /* Input wrapper */
  .sb-ui-datepicker__wrapper {
    display: flex;
    position: relative;
    align-items: stretch;
    
    /* El input hijo (.sb-ui-input) hereda todo del componente input Ã¡tomo */
    /* Solo ajustamos el padding para el Ã­cono */
    & .sb-ui-input {
      flex: 1;
      inline-size: 100%;
      padding-inline-end: calc(var(--sb-ui-datepicker-trigger-size) + 0.5rem) !important;
      cursor: pointer;
    }
  }
  
  /* Trigger button */
  .sb-ui-datepicker__trigger {
    position: absolute;
    inset-inline-end: 0;
    inset-block-start: 0;
    block-size: 100%;
    
    display: flex;
    align-items: center;
    justify-content: center;
    
    inline-size: var(--sb-ui-datepicker-trigger-size);
    
    background-color: var(--sb-ui-datepicker-trigger-bg);
    color: var(--sb-ui-datepicker-trigger-color);
    
    border: none;
    border-start-end-radius: var(--sb-ui-input-border-radius, 6px);
    border-end-end-radius: var(--sb-ui-input-border-radius, 6px);
    
    cursor: pointer;
    transition: var(--sb-ui-datepicker-transition);
    font-size: 1.25rem;
    
    &:hover:not(:disabled) {
      background-color: var(--sb-ui-datepicker-trigger-bg-hover);
      color: var(--sb-ui-datepicker-trigger-color-hover);
    }
    
    &:active:not(:disabled) {
      background-color: var(--sb-ui-datepicker-trigger-bg-active);
    }
    
    &:focus-visible {
      outline: 3px solid var(--sb-ui-color-secondary-L100);
      outline-offset: -3px;
      z-index: 1;
    }
    
    &:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  }
  
  /* Icon */
  .sb-ui-datepicker__icon {
    display: block;
    inline-size: 20px;
    block-size: 20px;
    fill: currentColor;
  }
  
  /* Dropdown */
  .sb-ui-datepicker__dropdown {
    position: absolute;
    inset-block-start: 100%;
    inset-inline-start: 0;
    z-index: 1000;
    
    margin-block-start: var(--sb-ui-datepicker-dropdown-margin-block-start);
    
    background-color: var(--sb-ui-datepicker-dropdown-bg);
    border: var(--sb-ui-datepicker-dropdown-border-width) solid var(--sb-ui-datepicker-dropdown-border-color);
    border-radius: var(--sb-ui-datepicker-dropdown-border-radius);
    box-shadow: var(--sb-ui-datepicker-dropdown-shadow);
    
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: opacity 0.2s ease, transform 0.2s ease, visibility 0s 0.2s;
    
    /* Calendar inside dropdown has no border/shadow */
    & .sb-ui-calendar {
      border: none;
      box-shadow: none;
      inline-size: auto;
    }
  }
  
  /* Dropdown open state */
  .sb-ui-datepicker--open .sb-ui-datepicker__dropdown {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
    transition: opacity 0.2s ease, transform 0.2s ease;
  }
}

/* ========================================
   VARIANTS LAYER
   ======================================== */
@layer variants {
  /* Error state - delegates to sb-ui-input */
}

/* ========================================
   SIZES LAYER
   ======================================== */
@layer sizes {
  .sb-ui-datepicker--small {
    --sb-ui-datepicker-input-font-size: clamp(0.75rem, 0.7rem + 0.2vw, 0.875rem);
    --sb-ui-datepicker-input-padding-inline: clamp(0.5rem, 0.4rem + 0.3vw, 0.75rem);
    --sb-ui-datepicker-input-padding-block: clamp(0.375rem, 0.3rem + 0.2vw, 0.5rem);
    --sb-ui-datepicker-trigger-size: clamp(28px, 1.8rem + 0.5vw, 36px);
  }
  
  .sb-ui-datepicker--large {
    --sb-ui-datepicker-input-font-size: clamp(1rem, 0.9rem + 0.4vw, 1.25rem);
    --sb-ui-datepicker-input-padding-inline: clamp(1rem, 0.8rem + 0.8vw, 1.5rem);
    --sb-ui-datepicker-input-padding-block: clamp(0.75rem, 0.6rem + 0.5vw, 1rem);
    --sb-ui-datepicker-trigger-size: clamp(44px, 2.6rem + 0.5vw, 52px);
  }
}

/* ========================================
   MODIFIERS LAYER
   ======================================== */
@layer modifiers {
  .sb-ui-datepicker--block {
    inline-size: 100%;
  }
  
  .sb-ui-datepicker--with-label {
    display: flex;
    flex-direction: column;
    gap: clamp(0.25rem, 0.2rem + 0.3vw, 0.5rem);
  }
}

/* ========================================
   STATES LAYER
   ======================================== */
@layer states {
  .sb-ui-datepicker--disabled {
    pointer-events: none;
    opacity: 0.6;
  }
  
  .sb-ui-datepicker--loading {
    pointer-events: none;
    
    .sb-ui-datepicker__trigger::after {
      content: '';
      display: block;
      inline-size: 16px;
      block-size: 16px;
      border: 2px solid currentColor;
      border-block-start-color: transparent;
      border-radius: 50%;
      animation: sb-ui-datepicker-spin 0.6s linear infinite;
    }
    
    .sb-ui-datepicker__icon {
      display: none;
    }
  }
}

/* ========================================
   UTILITIES LAYER (mÃ¡xima prioridad)
   ======================================== */
@layer utilities {
  /* High contrast mode support - el input hereda de sb-ui-input */
  @media (prefers-contrast: high) {
    .sb-ui-datepicker__wrapper .sb-ui-input {
      border-width: 2px;
    }
  }
  
  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .sb-ui-datepicker,
    .sb-ui-datepicker__wrapper .sb-ui-input,
    .sb-ui-datepicker__trigger,
    .sb-ui-datepicker__dropdown {
      --sb-ui-datepicker-transition: none;
      animation: none;
      transition: none;
    }
  }
}

/* ========================================
   ANIMATIONS
   ======================================== */
@keyframes sb-ui-datepicker-spin {
  to {
    transform: rotate(360deg);
  }
}

