/**
 * TextArea Component - Root Block Design System
 * Componente CSS puro con variables --sb-ui-* personalizables por marca
 * Incluye contador de caracteres y auto-resize
 * 
 * Uso:
 * <textarea class="rb-textarea" placeholder="Escribe tu mensaje aquí"></textarea>
 * <textarea class="rb-textarea rb-textarea--error" maxlength="100"></textarea>
 * <textarea class="rb-textarea rb-textarea--with-counter" maxlength="500"></textarea>
 */

/* ========================================
   VARIABLES CSS PERSONALIZABLES Y ESTILOS BASE
   ======================================== */

.sb-ui-textarea {
  /* Colores - Pueden ser sobreescritos por marca */
  --sb-ui-textarea-bg-color: var(--sb-ui-color-grayscale-white, #ffffff);
  --sb-ui-textarea-bg-disabled: var(--sb-ui-color-grayscale-L300, #f2f3f5);
  --sb-ui-textarea-text-color: var(--sb-ui-color-grayscale-D300, #404040);
  --sb-ui-textarea-text-placeholder: var(--sb-ui-color-grayscale-base, #d9d9d9);
  --sb-ui-textarea-text-disabled: var(--sb-ui-color-grayscale-base, #d9d9d9);
  --sb-ui-textarea-border-color: var(--sb-ui-color-grayscale-L200, #edeef0);
  --sb-ui-textarea-border-color-focus: var(--sb-ui-color-primary-base, #007acc);
  --sb-ui-textarea-border-color-error: var(--sb-ui-color-feedback-error-base, #dc3545);
  --sb-ui-textarea-border-color-success: var(--sb-ui-color-feedback-success-base, #28a745);
  --sb-ui-textarea-border-width: 1px;
  --sb-ui-textarea-border-radius: 8px;

  /* Espaciado */
  --sb-ui-textarea-padding-x: 1rem;
  --sb-ui-textarea-padding-y: 0.75rem;
  --sb-ui-textarea-padding-bottom-counter: 2.5rem;

  /* Tipografía */
  --sb-ui-textarea-font-family: var(--sb-ui-typography-fontFamily, 'Roboto', sans-serif);
  --sb-ui-textarea-font-size: 1rem;
  --sb-ui-textarea-font-weight: 400;
  --sb-ui-textarea-line-height: 1.5;

  /* Tamaños */
  --sb-ui-textarea-min-height: 80px;
  --sb-ui-textarea-max-height: 200px;

  /* Sombras */
  --sb-ui-textarea-shadow: none;
  --sb-ui-textarea-shadow-focus: 0 0 0 3px var(--sb-ui-color-primary-L400, rgba(0, 122, 204, 0.1));

  /* Transiciones */
  --sb-ui-textarea-transition: all 0.2s ease;

  /* Resize */
  --sb-ui-textarea-resize: vertical;

  /* Layout */
  display: block;
  width: 100%;
  position: relative;
  box-sizing: border-box;

  /* Spacing */
  padding: var(--sb-ui-textarea-padding-y) var(--sb-ui-textarea-padding-x);

  /* Sizing */
  min-height: var(--sb-ui-textarea-min-height);
  max-height: var(--sb-ui-textarea-max-height);

  /* Typography */
  font-family: var(--sb-ui-textarea-font-family);
  font-style: normal;
  font-weight: var(--sb-ui-textarea-font-weight);
  font-size: var(--sb-ui-textarea-font-size);
  line-height: var(--sb-ui-textarea-line-height);

  /* Appearance */
  background-color: var(--sb-ui-textarea-bg-color);
  color: var(--sb-ui-textarea-text-color);
  border: var(--sb-ui-textarea-border-width) solid var(--sb-ui-textarea-border-color);
  border-radius: var(--sb-ui-textarea-border-radius);
  box-shadow: var(--sb-ui-textarea-shadow);
  outline: none;
  resize: var(--sb-ui-textarea-resize);

  /* Animation */
  transition: var(--sb-ui-textarea-transition);
}

/* Placeholder styling */
.sb-ui-textarea::placeholder {
  color: var(--sb-ui-textarea-text-placeholder);
  opacity: 1;
}

.sb-ui-textarea::-webkit-input-placeholder {
  color: var(--sb-ui-textarea-text-placeholder);
  opacity: 1;
}

.sb-ui-textarea::-moz-placeholder {
  color: var(--sb-ui-textarea-text-placeholder);
  opacity: 1;
}

.sb-ui-textarea:-ms-input-placeholder {
  color: var(--sb-ui-textarea-text-placeholder);
  opacity: 1;
}

/* Focus state */
.sb-ui-textarea:focus {
  border-color: var(--sb-ui-textarea-border-color-focus);
  box-shadow: var(--sb-ui-textarea-shadow-focus);
}

/* Disabled state */
.sb-ui-textarea:disabled {
  background-color: var(--sb-ui-textarea-bg-disabled);
  color: var(--sb-ui-textarea-text-disabled);
  border-color: var(--sb-ui-textarea-bg-disabled);
  cursor: not-allowed;
  opacity: 0.6;
  resize: none;
}

.sb-ui-textarea:disabled::placeholder {
  color: var(--sb-ui-textarea-text-disabled);
}

/* ========================================
   TEXTAREA VARIANTS
   ======================================== */

/* Default textarea (no specific variant) */
.sb-ui-textarea {
  /* Usa estilos base */
}

/* ========================================
   TEXTAREA STATES
   ======================================== */

/* Error state */
.sb-ui-textarea--error {
  --sb-ui-textarea-border-color: var(--sb-ui-textarea-border-color-error);
  --sb-ui-textarea-border-color-focus: var(--sb-ui-textarea-border-color-error);
  --sb-ui-textarea-shadow-focus: 0 0 0 3px var(--sb-ui-color-feedback-error-L400, rgba(220, 53, 69, 0.1));
}

.sb-ui-textarea--error:focus {
  border-color: var(--sb-ui-textarea-border-color-error);
  box-shadow: var(--sb-ui-textarea-shadow-focus);
}

/* Success state */
.sb-ui-textarea--success {
  --sb-ui-textarea-border-color: var(--sb-ui-textarea-border-color-success);
  --sb-ui-textarea-border-color-focus: var(--sb-ui-textarea-border-color-success);
  --sb-ui-textarea-shadow-focus: 0 0 0 3px
    var(--sb-ui-color-feedback-success-L400, rgba(40, 167, 69, 0.1));
}

.sb-ui-textarea--success:focus {
  border-color: var(--sb-ui-textarea-border-color-success);
  box-shadow: var(--sb-ui-textarea-shadow-focus);
}

/* Warning state */
.sb-ui-textarea--warning {
  --sb-ui-textarea-border-color: var(--sb-ui-color-feedback-warning-base, #ffc107);
  --sb-ui-textarea-border-color-focus: var(--sb-ui-color-feedback-warning-base, #ffc107);
  --sb-ui-textarea-shadow-focus: 0 0 0 3px
    var(--sb-ui-color-feedback-warning-L400, rgba(255, 193, 7, 0.1));
}

.sb-ui-textarea--warning:focus {
  border-color: var(--sb-ui-color-feedback-warning-base, #ffc107);
  box-shadow: var(--sb-ui-textarea-shadow-focus);
}

/* ========================================
   TEXTAREA SIZES
   ======================================== */

.sb-ui-textarea--small {
  --sb-ui-textarea-padding-x: 0.75rem;
  --sb-ui-textarea-padding-y: 0.5rem;
  --sb-ui-textarea-font-size: 0.875rem;
  --sb-ui-textarea-min-height: 60px;
  --sb-ui-textarea-max-height: 150px;
  --sb-ui-textarea-line-height: 1.25;
  --sb-ui-textarea-padding-bottom-counter: 2rem;
}

.sb-ui-textarea--medium {
  --sb-ui-textarea-padding-x: 1rem;
  --sb-ui-textarea-padding-y: 0.75rem;
  --sb-ui-textarea-font-size: 1rem;
  --sb-ui-textarea-min-height: 80px;
  --sb-ui-textarea-max-height: 200px;
  --sb-ui-textarea-line-height: 1.5;
  --sb-ui-textarea-padding-bottom-counter: 2.5rem;
}

.sb-ui-textarea--large {
  --sb-ui-textarea-padding-x: 1.25rem;
  --sb-ui-textarea-padding-y: 1rem;
  --sb-ui-textarea-font-size: 1.125rem;
  --sb-ui-textarea-min-height: 100px;
  --sb-ui-textarea-max-height: 250px;
  --sb-ui-textarea-line-height: 1.5;
  --sb-ui-textarea-padding-bottom-counter: 3rem;
}

/* ========================================
   TEXTAREA MODIFIERS
   ======================================== */

/* Rounded corners */
.sb-ui-textarea--rounded {
  --sb-ui-textarea-border-radius: 2.1rem;
}

/* Block (full width) - ya es por defecto */
.sb-ui-textarea--block {
  width: 100%;
}

/* Inline (auto width) */
.sb-ui-textarea--inline {
  width: auto;
  min-width: 200px;
}

/* No resize */
.sb-ui-textarea--no-resize {
  --sb-ui-textarea-resize: none;
}

/* Both resize */
.sb-ui-textarea--resize-both {
  --sb-ui-textarea-resize: both;
}

/* Horizontal resize */
.sb-ui-textarea--resize-horizontal {
  --sb-ui-textarea-resize: horizontal;
}

/* Auto resize (requires JavaScript) */
.sb-ui-textarea--auto-resize {
  --sb-ui-textarea-resize: none;
  overflow: hidden;
}

/* ========================================
   TEXTAREA CONTAINER (for counter and labels)
   ======================================== */

.sb-ui-textarea-container {
  position: relative;
  display: block;
  width: 100%;
}

.sb-ui-textarea-container--inline {
  display: inline-block;
  width: auto;
}

/* ========================================
   CHARACTER COUNTER
   ======================================== */

.sb-ui-textarea-counter {
  position: absolute;
  bottom: 0.5rem;
  right: 0.75rem;
  font-family: var(--sb-ui-textarea-font-family);
  font-size: 0.75rem;
  font-weight: 400;
  color: var(--sb-ui-color-grayscale-base, #d9d9d9);
  line-height: 1;
  pointer-events: none;
  z-index: 2;
  transition: var(--sb-ui-textarea-transition);
  background-color: var(--sb-ui-textarea-bg-color, #ffffff);
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

/* Counter states */
.sb-ui-textarea-counter--warning {
  color: var(--sb-ui-color-feedback-warning-base, #ffc107);
  font-weight: 600;
}

.sb-ui-textarea-counter--error {
  color: var(--sb-ui-color-feedback-error-base, #dc3545);
  font-weight: 600;
}

.sb-ui-textarea-counter--success {
  color: var(--sb-ui-color-feedback-success-base, #28a745);
  font-weight: 600;
}

/* Counter with background for better visibility */
.sb-ui-textarea-counter--with-bg {
  background-color: var(--sb-ui-color-grayscale-L400, #f7f7f7);
  border: 1px solid var(--sb-ui-color-grayscale-L200, #edeef0);
}

.sb-ui-textarea-counter--warning.sb-ui-textarea-counter--with-bg {
  background-color: var(--sb-ui-color-feedback-warning-L400, #feeee5);
  border-color: var(--sb-ui-color-feedback-warning-L300, #ffbb88);
}

.sb-ui-textarea-counter--error.sb-ui-textarea-counter--with-bg {
  background-color: var(--sb-ui-color-feedback-error-L400, #fbe7e8);
  border-color: var(--sb-ui-color-feedback-error-L300, #f5c2c7);
}

.sb-ui-textarea-counter--success.sb-ui-textarea-counter--with-bg {
  background-color: var(--sb-ui-color-feedback-success-L400, #e5f3ec);
  border-color: var(--sb-ui-color-feedback-success-L300, #7ed8ac);
}

/* ========================================
   TEXTAREA WITH COUNTER
   ======================================== */

.sb-ui-textarea--with-counter {
  padding-bottom: var(--sb-ui-textarea-padding-bottom-counter);
}

/* ========================================
   TEXTAREA LABEL
   ======================================== */

.sb-ui-textarea-label {
  display: block;
  margin-bottom: 0.5rem;
  font-family: var(--sb-ui-textarea-font-family);
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--sb-ui-color-grayscale-D300, #404040);
  line-height: 1.25;
}

.sb-ui-textarea-label--required::after {
  content: ' *';
  color: var(--sb-ui-color-feedback-error-base, #dc3545);
}

.sb-ui-textarea-label--optional::after {
  content: ' (opcional)';
  color: var(--sb-ui-color-grayscale-base, #d9d9d9);
  font-weight: 400;
}

/* ========================================
   TEXTAREA HELPER TEXT
   ======================================== */

.sb-ui-textarea-helper {
  display: block;
  margin-top: 0.25rem;
  font-family: var(--sb-ui-textarea-font-family);
  font-size: 0.75rem;
  color: var(--sb-ui-color-grayscale-base, #d9d9d9);
  line-height: 1.25;
}

.sb-ui-textarea-helper--error {
  color: var(--sb-ui-color-feedback-error-base, #dc3545);
}

.sb-ui-textarea-helper--success {
  color: var(--sb-ui-color-feedback-success-base, #28a745);
}

.sb-ui-textarea-helper--warning {
  color: var(--sb-ui-color-feedback-warning-base, #ffc107);
}

/* ========================================
   TEXTAREA GROUP (multiple textareas)
   ======================================== */

.sb-ui-textarea-group {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  width: 100%;
}

.sb-ui-textarea-group--horizontal {
  flex-direction: row;
  gap: 1rem;
}

.sb-ui-textarea-group--horizontal .sb-ui-textarea {
  flex: 1;
}

/* ========================================
   ACCESSIBILITY & RESPONSIVE
   ======================================== */

/* High contrast mode support */
@media (prefers-contrast: high) {
  .sb-ui-textarea {
    --sb-ui-textarea-border-width: 2px;
  }

  .sb-ui-textarea-counter {
    border: 1px solid var(--sb-ui-color-grayscale-D200, #6e6e6e);
  }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  .sb-ui-textarea {
    --sb-ui-textarea-transition: none;
  }
}

/* Mobile optimizations */
@media (width <= 640px) {
  .sb-ui-textarea {
    font-size: 16px; /* Prevents zoom on iOS */
  }

  .sb-ui-textarea--small {
    font-size: 16px;
  }

  .sb-ui-textarea-group--horizontal {
    flex-direction: column;
  }

  .sb-ui-textarea-counter {
    position: static;
    margin-top: 0.5rem;
    text-align: right;
    background: none;
    box-shadow: none;
    padding: 0;
  }
}

/* Desktop optimizations */
@media (width >= 641px) {
  .sb-ui-textarea--inline {
    min-width: 250px;
  }
}

/* Print styles */
@media print {
  .sb-ui-textarea {
    background: transparent !important;
    color: black !important;
    border: 1px solid black !important;
    box-shadow: none !important;
    resize: none !important;
  }

  .sb-ui-textarea::placeholder {
    color: #666 !important;
  }

  .sb-ui-textarea-counter {
    display: none;
  }
}

/* ========================================
   FOCUS VISIBLE (keyboard navigation)
   ======================================== */

.sb-ui-textarea:focus-visible {
  outline: 2px solid var(--sb-ui-color-primary-base, #007acc);
  outline-offset: 2px;
}

/* ========================================
   VALIDATION STYLES
   ======================================== */

.sb-ui-textarea:valid:not(:placeholder-shown) {
  /* Success styling for valid textareas */
}

.sb-ui-textarea:invalid:not(:placeholder-shown) {
  /* Error styling for invalid textareas */
}

/* Custom validation message styling */
.sb-ui-textarea:invalid:not(:placeholder-shown) + .sb-ui-textarea-helper {
  color: var(--sb-ui-color-feedback-error-base, #dc3545);
}

/* ========================================
   AUTO-RESIZE FUNCTIONALITY (CSS-only approach)
   ======================================== */

/* This requires JavaScript to work properly, but we provide the CSS structure */
.sb-ui-textarea--auto-resize {
  resize: none;
  overflow: hidden;
  min-height: var(--sb-ui-textarea-min-height);
  max-height: none;
}

/* ========================================
   COUNTER ANIMATIONS
   ======================================== */

.sb-ui-textarea-counter--pulse {
  animation: rb-textarea-counter-pulse 0.3s ease-in-out;
}

@keyframes rb-textarea-counter-pulse {
  0% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.1);
  }
  100% {
    transform: scale(1);
  }
}

/* ========================================
   LOADING STATE
   ======================================== */

.sb-ui-textarea--loading {
  position: relative;
  pointer-events: none;
  opacity: 0.7;
}

.sb-ui-textarea--loading::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 20px;
  height: 20px;
  margin: -10px 0 0 -10px;
  border: 2px solid var(--sb-ui-color-grayscale-L200, #edeef0);
  border-top-color: var(--sb-ui-color-primary-base, #007acc);
  border-radius: 50%;
  animation: rb-textarea-spinner 1s linear infinite;
  z-index: 3;
}

@keyframes rb-textarea-spinner {
  to {
    transform: rotate(360deg);
  }
}

/* ========================================
   DARK MODE SUPPORT
   ======================================== */

@media (prefers-color-scheme: dark) {
  .sb-ui-textarea-counter {
    background-color: var(--sb-ui-color-grayscale-D300, #404040);
    color: var(--sb-ui-color-grayscale-L200, #edeef0);
  }

  .sb-ui-textarea-counter--with-bg {
    background-color: var(--sb-ui-color-grayscale-D200, #6e6e6e);
    border-color: var(--sb-ui-color-grayscale-D100, #8c8c8c);
  }
}
