/**
 * Input Component - Seguros Bolivar UI Design System
 * - CSS Nesting nativo con &
 * - @layer para control de cascada
 * - Logical Properties (RTL/LTR)
 * - clamp() para responsive fluido
 *
 * Uso: <input class="sb-ui-input" type="text" placeholder="Placeholder">
 */

@layer reset, tokens, base, variants, sizes, modifiers, states, utilities;

/* ========================================
   RESET LAYER
   ======================================== */
@layer reset {
  .sb-ui-input {
    box-sizing: border-box;
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
  }

  .sb-ui-input-container {
    box-sizing: border-box;
  }

  .sb-ui-input-label {
    box-sizing: border-box;
  }

  .sb-ui-input-helper {
    box-sizing: border-box;
  }

  .sb-ui-input-icon {
    box-sizing: border-box;
  }
}

/* ========================================
   TOKENS LAYER - Variables CSS
   ======================================== */
@layer tokens {
  .sb-ui-input {
    /* Colores BASE - Estados interactivos */
    --sb-ui-input-bg-color: var(--sb-ui-color-grayscale-white, #fff);
    --sb-ui-input-bg-hover: var(--sb-ui-color-grayscale-white, #fff);
    --sb-ui-input-bg-focus: var(--sb-ui-color-grayscale-white, #fff);
    --sb-ui-input-bg-disabled: var(--sb-ui-color-grayscale-L300, #f5f5f5);

    --sb-ui-input-text-color: var(--sb-ui-color-grayscale-black, #000);
    --sb-ui-input-text-hover: var(--sb-ui-color-grayscale-black, #000);
    --sb-ui-input-text-focus: var(--sb-ui-color-grayscale-black, #000);
    --sb-ui-input-text-disabled: var(--sb-ui-color-grayscale-base, #9b9b9b);
    --sb-ui-input-text-placeholder: var(--sb-ui-color-grayscale-base, #9b9b9b);

    --sb-ui-input-border-color: var(--sb-ui-color-grayscale-L200, #e1e1e1);
    --sb-ui-input-border-hover: var(--sb-ui-color-grayscale-L200, #e1e1e1);
    --sb-ui-input-border-focus: var(--sb-ui-color-primary-base, #007acc);
    --sb-ui-input-border-disabled: var(--sb-ui-color-grayscale-L200, #e1e1e1);

    /* Espaciado - SIEMPRE con clamp() */
    --sb-ui-input-padding-inline: clamp(0.8rem, 0.5rem + 1.5vw, 1rem);
    --sb-ui-input-padding-block: clamp(0.6rem, 0.4rem + 0.8vw, 0.875rem);
    --sb-ui-input-padding-inline-end-icon: clamp(2rem, 1.8rem + 1vw, 2.5rem);

    /* Tipografía - SIEMPRE con clamp() */
    --sb-ui-input-font-family: var(--sb-ui-typography-fontFamily, 'Roboto', sans-serif);
    --sb-ui-input-font-size: clamp(0.875rem, 0.8rem + 0.3vw, 1rem);
    --sb-ui-input-font-weight: 400;
    --sb-ui-input-line-height: 1.5;

    /* Label */
    --sb-ui-input-label-color: var(--sb-ui-color-grayscale-black, #000);
    --sb-ui-input-label-font-size: clamp(0.75rem, 0.7rem + 0.2vw, 0.875rem);
    --sb-ui-input-label-font-weight: 600;
    --sb-ui-input-label-margin-block-end: clamp(0.25rem, 0.2rem + 0.2vw, 0.375rem);

    /* Helper text */
    --sb-ui-input-helper-color: var(--sb-ui-color-grayscale-base, #9b9b9b);
    --sb-ui-input-helper-font-size: clamp(0.75rem, 0.7rem + 0.2vw, 0.875rem);
    --sb-ui-input-helper-margin-block-start: clamp(0.25rem, 0.2rem + 0.2vw, 0.375rem);

    /* Tamaños - Logical properties */
    --sb-ui-input-min-block-size: clamp(40px, 8vw, 44px);
    --sb-ui-input-inline-size: 100%;

    /* Bordes */
    --sb-ui-input-border-width: 1px;
    --sb-ui-input-border-radius: clamp(6px, 0.4rem + 0.3vw, 8px);

    /* Sombras */
    --sb-ui-input-shadow: none;
    --sb-ui-input-shadow-focus: 0 0 0 3px var(--sb-ui-color-primary-L400, rgba(0, 122, 204, 0.1));

    /* Transiciones - NO incluir outline para evitar destellos en focus */
    --sb-ui-input-transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease,
      box-shadow 0.2s ease;

    /* Íconos */
    --sb-ui-input-icon-size: clamp(1rem, 0.9rem + 0.3vw, 1.25rem);
    --sb-ui-input-icon-color: var(--sb-ui-color-grayscale-base, #9b9b9b);
    --sb-ui-input-icon-inset-inline-end: clamp(0.75rem, 0.6rem + 0.5vw, 1rem);
  }
}

/* ========================================
   BASE LAYER - Estilos base
   ======================================== */
@layer base {
  /* Container wrapper */
  .sb-ui-input-container {
    display: block;
    position: relative;
    inline-size: 100%;
  }

  /* Input field */
  .sb-ui-input {
    /* Layout */
    display: block;
    position: relative;
    inline-size: var(--sb-ui-input-inline-size);

    /* Spacing - SOLO Logical Properties */
    padding-inline: var(--sb-ui-input-padding-inline);
    padding-block: var(--sb-ui-input-padding-block);

    /* Typography */
    font-family: var(--sb-ui-input-font-family);
    font-size: var(--sb-ui-input-font-size);
    font-weight: var(--sb-ui-input-font-weight);
    line-height: var(--sb-ui-input-line-height);

    /* Sizing */
    min-block-size: var(--sb-ui-input-min-block-size);

    /* Appearance */
    background-color: var(--sb-ui-input-bg-color);
    color: var(--sb-ui-input-text-color);
    border: var(--sb-ui-input-border-width) solid var(--sb-ui-input-border-color);
    border-radius: var(--sb-ui-input-border-radius);
    box-shadow: var(--sb-ui-input-shadow);

    /* Animation */
    transition: var(--sb-ui-input-transition);

    /* Nested Pseudo-classes - SIEMPRE usar & */
    &::placeholder {
      color: var(--sb-ui-input-text-placeholder);
      opacity: 1;
    }

    &:hover:not(:disabled):not(:focus) {
      background-color: var(--sb-ui-input-bg-hover);
      color: var(--sb-ui-input-text-hover, var(--sb-ui-input-text-color));
      border-color: var(--sb-ui-input-border-hover, var(--sb-ui-input-border-color));
    }

    &:focus {
      background-color: var(--sb-ui-input-bg-focus);
      color: var(--sb-ui-input-text-focus, var(--sb-ui-input-text-color));
      border-color: var(--sb-ui-input-border-focus);
      box-shadow: var(--sb-ui-input-shadow-focus);
      outline: none;
    }

    &:focus-visible {
      outline: 2px solid var(--sb-ui-color-secondary-L100, #66bc9a);
      outline-offset: 2px;
    }

    &:disabled,
    &.sb-ui-input--disabled {
      background-color: var(--sb-ui-input-bg-disabled);
      color: var(--sb-ui-input-text-disabled);
      border-color: var(--sb-ui-input-border-disabled);
      cursor: not-allowed;
      opacity: 0.6;
    }

    /* Con ícono a la derecha */
    &.sb-ui-input--with-icon {
      padding-inline-end: var(--sb-ui-input-padding-inline-end-icon);
    }
  }

  /* Label */
  .sb-ui-input-label {
    display: block;
    margin-block-end: var(--sb-ui-input-label-margin-block-end);
    font-family: var(--sb-ui-input-font-family);
    font-size: var(--sb-ui-input-label-font-size);
    font-weight: var(--sb-ui-input-label-font-weight);
    color: var(--sb-ui-input-label-color);
    line-height: 1.25;

    &--required::after {
      content: ' *';
      color: var(--sb-ui-color-feedback-error-base, #dc3545);
    }

    &--optional::after {
      content: ' (opcional)';
      color: var(--sb-ui-color-grayscale-base, #9b9b9b);
      font-weight: 400;
    }
  }

  /* Helper text */
  .sb-ui-input-helper {
    display: block;
    margin-block-start: var(--sb-ui-input-helper-margin-block-start);
    font-family: var(--sb-ui-input-font-family);
    font-size: var(--sb-ui-input-helper-font-size);
    color: var(--sb-ui-input-helper-color);
    line-height: 1.25;
  }

  /* Ícono del input (derecha) */
  .sb-ui-input-icon {
    position: absolute;
    inset-block-start: 50%;
    inset-inline-end: var(--sb-ui-input-icon-inset-inline-end);
    transform: translateY(-50%);
    font-size: var(--sb-ui-input-icon-size);
    color: var(--sb-ui-input-icon-color);
    pointer-events: none;
    transition: var(--sb-ui-input-transition);
  }
}

/* ========================================
   STATES LAYER
   ======================================== */
@layer states {
  /* Success state */
  .sb-ui-input--success {
    --sb-ui-input-border-color: var(--sb-ui-color-feedback-success-base, #28a745);
    --sb-ui-input-border-focus: var(--sb-ui-color-feedback-success-base, #28a745);
    --sb-ui-input-shadow-focus: 0 0 0 3px var(--sb-ui-color-feedback-success-L400, rgba(40, 167, 69, 0.1));

    & + .sb-ui-input-icon {
      color: var(--sb-ui-color-feedback-success-base, #28a745);
    }
  }

  .sb-ui-input--success ~ .sb-ui-input-helper {
    color: var(--sb-ui-color-feedback-success-base, #28a745);
  }

  /* Error state */
  .sb-ui-input--error {
    --sb-ui-input-border-color: var(--sb-ui-color-feedback-error-base, #dc3545);
    --sb-ui-input-border-focus: var(--sb-ui-color-feedback-error-base, #dc3545);
    --sb-ui-input-shadow-focus: 0 0 0 3px var(--sb-ui-color-feedback-error-L400, rgba(220, 53, 69, 0.1));

    & + .sb-ui-input-icon {
      color: var(--sb-ui-color-feedback-error-base, #dc3545);
    }
  }

  .sb-ui-input--error ~ .sb-ui-input-helper {
    color: var(--sb-ui-color-feedback-error-base, #dc3545);
  }

  /* Warning state */
  .sb-ui-input--warning {
    --sb-ui-input-border-color: var(--sb-ui-color-feedback-warning-base, #ffc107);
    --sb-ui-input-border-focus: var(--sb-ui-color-feedback-warning-base, #ffc107);
    --sb-ui-input-shadow-focus: 0 0 0 3px var(--sb-ui-color-feedback-warning-L400, rgba(255, 193, 7, 0.1));

    & + .sb-ui-input-icon {
      color: var(--sb-ui-color-feedback-warning-base, #ffc107);
    }
  }

  .sb-ui-input--warning ~ .sb-ui-input-helper {
    color: var(--sb-ui-color-feedback-warning-base, #ffc107);
  }

  /* Disabled state */
  .sb-ui-input:disabled ~ .sb-ui-input-helper,
  .sb-ui-input.sb-ui-input--disabled ~ .sb-ui-input-helper {
    opacity: 0.6;
  }

  .sb-ui-input:disabled + .sb-ui-input-icon,
  .sb-ui-input.sb-ui-input--disabled + .sb-ui-input-icon {
    opacity: 0.6;
  }

  /* Focus state - icon color */
  .sb-ui-input:focus + .sb-ui-input-icon {
    color: var(--sb-ui-input-border-focus);
  }
}

/* ========================================
   SIZES LAYER
   ======================================== */
@layer sizes {
  .sb-ui-input--small {
    --sb-ui-input-font-size: clamp(0.75rem, 0.7rem + 0.2vw, 0.875rem);
    --sb-ui-input-padding-inline: clamp(0.6rem, 0.4rem + 0.8vw, 0.75rem);
    --sb-ui-input-padding-block: clamp(0.4rem, 0.3rem + 0.5vw, 0.5rem);
    --sb-ui-input-min-block-size: clamp(32px, 6vw, 36px);
    --sb-ui-input-padding-inline-end-icon: clamp(1.8rem, 1.6rem + 0.8vw, 2rem);
  }

  .sb-ui-input--large {
    --sb-ui-input-font-size: clamp(1rem, 0.9rem + 0.4vw, 1.125rem);
    --sb-ui-input-padding-inline: clamp(1rem, 0.8rem + 1.8vw, 1.25rem);
    --sb-ui-input-padding-block: clamp(0.8rem, 0.6rem + 1vw, 1rem);
    --sb-ui-input-min-block-size: clamp(48px, 10vw, 52px);
    --sb-ui-input-padding-inline-end-icon: clamp(2.5rem, 2.2rem + 1.2vw, 3rem);
  }
}

/* ========================================
   MODIFIERS LAYER
   ======================================== */
@layer modifiers {
  .sb-ui-input--rounded {
    --sb-ui-input-border-radius: clamp(1.5rem, 1.2rem + 1.5vw, 2.5rem);
  }

  .sb-ui-input--inline {
    --sb-ui-input-inline-size: auto;
    min-inline-size: clamp(180px, 30vw, 250px);
  }
}

/* ========================================
   UTILITIES LAYER (máxima prioridad)
   ======================================== */
@layer utilities {
  /* High contrast mode support - OBLIGATORIO */
  @media (prefers-contrast: high) {
    .sb-ui-input {
      --sb-ui-input-border-width: 2px;
    }
  }

  /* Reduced motion support - OBLIGATORIO */
  @media (prefers-reduced-motion: reduce) {
    .sb-ui-input {
      --sb-ui-input-transition: none;
    }
  }

  /* Mobile styles - Font size 16px para prevenir zoom en iOS */
  @media (inline-size <= 640px) {
    .sb-ui-input {
      font-size: max(16px, var(--sb-ui-input-font-size));
    }
  }

  /* Print styles */
  @media print {
    .sb-ui-input {
      background: transparent !important;
      color: black !important;
      border: 1px solid black !important;
      box-shadow: none !important;
    }
  }
}

/* ========================================
   AUTOFILL STYLES (fuera de @layer)
   ======================================== */
.sb-ui-input:-webkit-autofill,
.sb-ui-input:-webkit-autofill:hover,
.sb-ui-input:-webkit-autofill:focus,
.sb-ui-input:-webkit-autofill:active {
  -webkit-box-shadow: 0 0 0 30px var(--sb-ui-input-bg-color) inset !important;
  -webkit-text-fill-color: var(--sb-ui-input-text-color) !important;
  transition: background-color 5000s ease-in-out 0s;
}
